<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tutorial: How to use fhpredict • fhpredict</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Tutorial: How to use fhpredict">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fhpredict</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tutorial.html">Tutorial: How to use fhpredict</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/KWB-R/fhpredict">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Tutorial: How to use fhpredict</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/KWB-R/fhpredict/blob/master/vignettes/tutorial.Rmd"><code>vignettes/tutorial.Rmd</code></a></small>
      <div class="hidden name"><code>tutorial.Rmd</code></div>

    </div>

    
    
<div id="install-the-package" class="section level2">
<h2 class="hasAnchor">
<a href="#install-the-package" class="anchor"></a>Install the package</h2>
<p>Install the package fhpredict from GitHub, using the package remotes. Install from the “dev” branch to get the latest version:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="co"># install.packages(remotes)</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">remotes<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/remotes/man/install_github.html">install_github</a></span>(<span class="st">"kwb-r/fhpredict@dev"</span>, <span class="dt">build_vignettes =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
</div>
<div id="users" class="section level2">
<h2 class="hasAnchor">
<a href="#users" class="anchor"></a>Users</h2>
<p>In the data model of the app everything is assigned to a user identified by a unique identifier, the user id. To get an overview on available users and their associated ids, run:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Get overview on available users in a data frame</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">users &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_users.html">api_get_users</a></span>()</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co"># Print the data frame</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5">users</a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="co">#&gt;   id    firstName              lastName     role protected</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="co">#&gt; 1  3 Flusshygiene                        creator     FALSE</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="co">#&gt; 2  4        Karla               Kolumna reporter     FALSE</span></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co">#&gt; 3  2        Conan         the Barbarian    admin      TRUE</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="co">#&gt; 4  1        Shera the Princess of Power reporter     FALSE</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="co">#&gt;                  createdAt version                updatedAt</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12"><span class="co">#&gt; 1 2019-08-29T23:13:51.297Z       1 2019-08-29T23:13:51.297Z</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"><span class="co">#&gt; 2 2019-08-29T23:13:51.297Z       1 2019-08-29T23:13:51.297Z</span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="co">#&gt; 3 2019-08-29T22:07:37.101Z       1 2019-08-29T22:07:37.101Z</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="co">#&gt; 4 2019-08-29T22:07:37.101Z       1 2019-08-29T22:07:37.101Z</span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="co">#&gt;                                        email</span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co">#&gt; 1                flusshygiene@protonmail.com</span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="co">#&gt; 2                        karla@bluemchen.dev</span></a>
<a class="sourceLine" id="cb2-19" data-line-number="19"><span class="co">#&gt; 3 moron-zirfas@technologiestiftung-berlin.de</span></a>
<a class="sourceLine" id="cb2-20" data-line-number="20"><span class="co">#&gt; 4 moron-zirfas@technologiestiftung-berlin.de</span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="co">#&gt;                          auth0Id</span></a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co">#&gt; 1 auth0|5cc86848839956107b7d19e1</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23"><span class="co">#&gt; 2                           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb2-24" data-line-number="24"><span class="co">#&gt; 3                           &lt;NA&gt;</span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="co">#&gt; 4                           &lt;NA&gt;</span></a></code></pre></div>
</div>
<div id="bathing-spots" class="section level2">
<h2 class="hasAnchor">
<a href="#bathing-spots" class="anchor"></a>Bathing Spots</h2>
<div id="overview-on-available-bathing-spots" class="section level3">
<h3 class="hasAnchor">
<a href="#overview-on-available-bathing-spots" class="anchor"></a>Overview on available bathing spots</h3>
<p>Use the function <code><a href="../reference/api_get_bathingspot.html">api_get_bathingspot()</a></code> to get an overview on the bathing spots that are stored in the postgres database. You need to specify the user to whom the bathing spots are associated. See above for how to get a list of available user ids.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Get overview on the first "limit" bathingspots associated to user with id 3</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">bathing_spots &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_bathingspot.html">api_get_bathingspot</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co"># Number of bathing spots returned</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(bathing_spots)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; [1] 50</span></a></code></pre></div>
<p>By default, only the first 50 bathing spots are considered in the returned data frame. Set the argument <code>limit</code> to a high number so that you get a list of all available bathing spots:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Get overview on all bathing spots associated to user with id 3</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">all_bathing_spots &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_bathingspot.html">api_get_bathingspot</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">limit =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3"></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="co"># Number of bathing spots returned</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(all_bathing_spots)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="co">#&gt; [1] 2451</span></a></code></pre></div>
</div>
<div id="fetching-data-related-to-one-bathing-spot" class="section level3">
<h3 class="hasAnchor">
<a href="#fetching-data-related-to-one-bathing-spot" class="anchor"></a>Fetching data related to one bathing spot</h3>
<p>Use the overview as retrieved above to lookup the bathing spot id that you are interested in. Then, call <code><a href="../reference/api_get_bathingspot.html">api_get_bathingspot()</a></code> again, this time by setting the argument <code>spot_id</code> accordingly:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Lookup bathing spots of interest by name</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">all_bathing_spots[<span class="kw"><a href="https://rdrr.io/r/base/grep.html">grep</a></span>(<span class="st">"AHLBECK"</span>, all_bathing_spots<span class="op">$</span>name), <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"id"</span>, <span class="st">"name"</span>)]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#&gt;        id              name</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#&gt; 647   647 AHLBECK SEEBRÜCKE</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#&gt; 1170 1170       AHLBECK FKK</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># Lookup the bathing spot id and store it in a variable spot_id</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">spot_id &lt;-<span class="st"> </span><span class="dv">1170</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"></a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co"># Load the data available for the corresponding bathing spot id</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">spot &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_bathingspot.html">api_get_bathingspot</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> spot_id)</a></code></pre></div>
<p>It is also possible to get a bathing spot without specifying a user id:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># It is also possible to get a bathing spot without specifying a user id</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">spot_no_user &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_bathingspot.html">api_get_bathingspot</a></span>(<span class="dt">spot_id =</span> spot_id)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="co"># Is this the same as what we get when a user is specified?</span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(spot, spot_no_user)</a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="co">#&gt; [1] TRUE</span></a></code></pre></div>
</div>
<div id="accessing-the-properties-of-a-bathing-spot" class="section level3">
<h3 class="hasAnchor">
<a href="#accessing-the-properties-of-a-bathing-spot" class="anchor"></a>Accessing the properties of a bathing spot</h3>
<p>The variable <code>spot</code> now contains a list of properties of the selected bathing spot. As the list contains a lot of <code>NULL</code> elements, we remove these elements before looking at the overall structure of the list:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># Look at the overall structure of the list omitting any NULL element</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(kwb.utils<span class="op">::</span><span class="kw">excludeNULL</span>(spot), <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt; Removing 38 list elements that are NULL ... ok. (0.00s) </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt; List of 22</span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  $ id                          : int 1170</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  $ createdAt                   : chr "2019-08-29T22:27:25.861Z"</span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  $ updatedAt                   : chr "2019-08-29T23:13:51.297Z"</span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  $ version                     : int 59</span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  $ bwId                        : chr "DEMV_PR_1_0724"</span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  $ coordinateSystem            : chr "ETRS89"</span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  $ type                        : chr "1"</span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  $ name                        : chr "AHLBECK FKK"</span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;  $ nameLong                    : chr "OSTSEE, AHLBECK, FKK-STRAND, RICHTUNG GRENZE"</span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;  $ isPublic                    : logi TRUE</span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt;  $ influencePurificationPlant  : chr "unknown"</span></a>
<a class="sourceLine" id="cb7-16" data-line-number="16"><span class="co">#&gt;  $ influenceCombinedSewerSystem: chr "unknown"</span></a>
<a class="sourceLine" id="cb7-17" data-line-number="17"><span class="co">#&gt;  $ influenceRainwater          : chr "unknown"</span></a>
<a class="sourceLine" id="cb7-18" data-line-number="18"><span class="co">#&gt;  $ influenceAgriculture        : chr "unknown"</span></a>
<a class="sourceLine" id="cb7-19" data-line-number="19"><span class="co">#&gt;  $ location                    :List of 2</span></a>
<a class="sourceLine" id="cb7-20" data-line-number="20"><span class="co">#&gt;  $ area                        :List of 2</span></a>
<a class="sourceLine" id="cb7-21" data-line-number="21"><span class="co">#&gt;  $ latitude                    : num 53.9</span></a>
<a class="sourceLine" id="cb7-22" data-line-number="22"><span class="co">#&gt;  $ longitude                   : num 14.2</span></a>
<a class="sourceLine" id="cb7-23" data-line-number="23"><span class="co">#&gt;  $ predictions                 : list()</span></a>
<a class="sourceLine" id="cb7-24" data-line-number="24"><span class="co">#&gt;  $ models                      : list()</span></a>
<a class="sourceLine" id="cb7-25" data-line-number="25"><span class="co">#&gt;  $ measurements                :List of 55</span></a>
<a class="sourceLine" id="cb7-26" data-line-number="26"><span class="co">#&gt;  $ area_coordinates            : num [1:33, 1:2] 14.3 14.3 14.3 14.3 14.2 ...</span></a>
<a class="sourceLine" id="cb7-27" data-line-number="27"><span class="co">#&gt;   ..- attr(*, "type")= chr "Polygon"</span></a></code></pre></div>
<p>Use the <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> operator to access the different properties of the bathing spot:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">spot<span class="op">$</span>id</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="co">#&gt; [1] 1170</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3">spot<span class="op">$</span>nameLong</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co">#&gt; [1] "OSTSEE, AHLBECK, FKK-STRAND, RICHTUNG GRENZE"</span></a></code></pre></div>
<div id="polygon-defining-the-catchment-area" class="section level4">
<h4 class="hasAnchor">
<a href="#polygon-defining-the-catchment-area" class="anchor"></a>Polygon defining the “catchment area”</h4>
<p>We are especially interested in the coordinates of the polygon that defines the area over which to average the rain data that is assumed to influence the water quality of the bathing spot. This information is stored in the list element <code>area</code>. It can be transformed into a GeoJSON string using the function <code>toJSON()</code> from the jsonlite package. There is also a list element <code>area_coordinates</code> that contains the same coordinates in the form of a two column data frame.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="co"># Polygon coordinates as a GeoJSON string</span></a>
<a class="sourceLine" id="cb9-2" data-line-number="2">jsonlite<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html">toJSON</a></span>(spot<span class="op">$</span>area)</a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="co">#&gt; {"type":["Polygon"],"coordinates":[[[[14.2827],[53.9524]],[[14.2739],[53.9587]],[[14.2631],[53.9639]],[[14.2509],[53.9677]],[[14.2376],[53.9701]],[[14.2237],[53.9709]],[[14.2099],[53.97]],[[14.1966],[53.9677]],[[14.1844],[53.9638]],[[14.1737],[53.9586]],[[14.1649],[53.9523]],[[14.1584],[53.945]],[[14.1545],[53.9372]],[[14.1531],[53.9291]],[[14.1545],[53.921]],[[14.1586],[53.9132]],[[14.1652],[53.906]],[[14.174],[53.8997]],[[14.1847],[53.8945]],[[14.197],[53.8907]],[[14.2102],[53.8883]],[[14.224],[53.8875]],[[14.2378],[53.8884]],[[14.2511],[53.8907]],[[14.2633],[53.8946]],[[14.274],[53.8998]],[[14.2828],[53.9061]],[[14.2893],[53.9133]],[[14.2933],[53.9211]],[[14.2947],[53.9293]],[[14.2933],[53.9374]],[[14.2893],[53.9452]],[[14.2827],[53.9524]]]]}</span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="co"># Polygon coordinates as a data frame</span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(spot<span class="op">$</span>area_coordinates)</a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="co">#&gt;          [,1]     [,2]</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="co">#&gt; [1,] 14.28270 53.95241</span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="co">#&gt; [2,] 14.27387 53.95872</span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="co">#&gt; [3,] 14.26313 53.96389</span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="co">#&gt; [4,] 14.25087 53.96773</span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="co">#&gt; [5,] 14.23757 53.97008</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="co">#&gt; [6,] 14.22374 53.97087</span></a></code></pre></div>
</div>
<div id="water-quality-measurements" class="section level4">
<h4 class="hasAnchor">
<a href="#water-quality-measurements" class="anchor"></a>Water quality measurements</h4>
<p>The <code>spot</code> object contains the results of water quality measurements in its list element <code>measurements</code>. Use the (non-exported) function <code>flatten_recursive_list</code> to convert the corresponding recursive list into a data frame.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="co"># Provide the measurements related to the bathing spot</span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2">measurements &lt;-<span class="st"> </span>fhpredict<span class="op">:::</span><span class="kw">flatten_recursive_list</span>(spot<span class="op">$</span>measurements)</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="co"># Have a look at the first measurements (after removing empty columns)</span></a>
<a class="sourceLine" id="cb10-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(kwb.utils<span class="op">::</span><span class="kw">removeEmptyColumns</span>(measurements))</a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="co">#&gt; measurements: 15 empty columns removed: sicht, conc_ec_txt, oldId, detailId, conc_ie_txt, temp, algen, cb, sichtTxt, tempTxt, algenTxt, bsl, state, wasserqualitaet, wasserqualitaetTxt</span></a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt;      id                createdAt                updatedAt</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt; 1 77290 2019-08-29T22:27:25.866Z 2019-08-29T22:27:25.879Z</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt; 2 77291 2019-08-29T22:27:25.884Z 2019-08-29T22:27:25.897Z</span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 3 77292 2019-08-29T22:27:25.902Z 2019-08-29T22:27:25.916Z</span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; 4 77293 2019-08-29T22:27:25.921Z 2019-08-29T22:27:25.938Z</span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; 5 77294 2019-08-29T22:27:25.944Z 2019-08-29T22:27:25.957Z</span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; 6 77295 2019-08-29T22:27:25.962Z 2019-08-29T22:27:25.975Z</span></a>
<a class="sourceLine" id="cb10-14" data-line-number="14"><span class="co">#&gt;                       date conc_ec conc_ie</span></a>
<a class="sourceLine" id="cb10-15" data-line-number="15"><span class="co">#&gt; 1 2009-05-19T00:00:00.000Z      15      15</span></a>
<a class="sourceLine" id="cb10-16" data-line-number="16"><span class="co">#&gt; 2 2009-06-16T00:00:00.000Z      77      15</span></a>
<a class="sourceLine" id="cb10-17" data-line-number="17"><span class="co">#&gt; 3 2009-08-11T00:00:00.000Z      15      15</span></a>
<a class="sourceLine" id="cb10-18" data-line-number="18"><span class="co">#&gt; 4 2008-06-10T00:00:00.000Z      15      15</span></a>
<a class="sourceLine" id="cb10-19" data-line-number="19"><span class="co">#&gt; 5 2009-07-14T00:00:00.000Z      15      15</span></a>
<a class="sourceLine" id="cb10-20" data-line-number="20"><span class="co">#&gt; 6 2009-09-08T00:00:00.000Z      46      15</span></a></code></pre></div>
</div>
</div>
</div>
<div id="models" class="section level2">
<h2 class="hasAnchor">
<a href="#models" class="anchor"></a>Models</h2>
<div id="overview-on-available-models" class="section level3">
<h3 class="hasAnchor">
<a href="#overview-on-available-models" class="anchor"></a>Overview on available models</h3>
<p>Use the function <code><a href="../reference/api_get_model.html">api_get_model()</a></code> to get an overview on the models that are stored in the postgres database. You need to pass the user id (here: 3) and the id of the bathing spot (here: 18) to the function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="co"># Read all models that are stored for one bathing spot of one user</span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2">model_info &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_model.html">api_get_model</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> <span class="dv">18</span>)</a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="co">#&gt; Reading all models from the database ... ok. (0.25s)</span></a></code></pre></div>
<p>The function returns a data frame with one row per available model:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="co"># Show meta information on the models</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2">model_info</a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="co">#&gt;   id                createdAt version                updatedAt</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="co">#&gt; 1  1 2019-08-30T09:49:17.482Z       2 2019-08-30T09:49:17.511Z</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="co">#&gt; 2  2 2019-08-30T09:50:54.242Z       2 2019-08-30T09:50:54.590Z</span></a>
<a class="sourceLine" id="cb12-6" data-line-number="6"><span class="co">#&gt;                                                                                    comment</span></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="co">#&gt; 1                                                                          Mein Automodell</span></a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; 2 Modell fuer die Kleine Badewiese, wie es im Paket  kwb.flusshygiene.app gespeichert ist.</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;   evaluation</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt; 1         NA</span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt; 2         NA</span></a></code></pre></div>
<p>Use this overview on available models to lookup the id of the model that you actually want to fetch from the database.</p>
</div>
<div id="fetching-a-model" class="section level3">
<h3 class="hasAnchor">
<a href="#fetching-a-model" class="anchor"></a>Fetching a model</h3>
<p>Use the model id to fetch a specific model from the database:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="co"># Load model with id 27 from the database</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">model &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_model.html">api_get_model</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> <span class="dv">18</span>, <span class="dt">model_id =</span> <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb13-3" data-line-number="3"><span class="co">#&gt; Reading model with id = 2 from the database ... ok. (0.96s) </span></a>
<a class="sourceLine" id="cb13-4" data-line-number="4"><span class="co">#&gt; Converting text to model object ...</span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="co">#&gt; Registered S3 method overwritten by 'xts':</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="co">#&gt;   method     from</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="co">#&gt;   as.zoo.xts zoo</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="co">#&gt; ok. (3.39s)</span></a></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="co"># Show the (rstan) model</span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(model)</a>
<a class="sourceLine" id="cb14-3" data-line-number="3"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="co">#&gt;  family:       gaussian [identity]</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="co">#&gt;  formula:      e.coli ~ Qm2mean * (Km3m1sum + Rm3asum)</span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="co">#&gt;  observations: 74</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7"><span class="co">#&gt; ------</span></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="co">#&gt;                  Median MAD_SD</span></a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; (Intercept)      1.0    0.2   </span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt; Qm2mean          0.0    0.0   </span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt; Km3m1sum         0.0    0.0   </span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; Rm3asum          0.1    0.1   </span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; Qm2mean:Km3m1sum 0.0    0.0   </span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; Qm2mean:Rm3asum  0.0    0.0   </span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; log-fit_ratio    0.0    0.1   </span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt; R2               0.7    0.1   </span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; Auxiliary parameter(s):</span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt;       Median MAD_SD</span></a>
<a class="sourceLine" id="cb14-20" data-line-number="20"><span class="co">#&gt; sigma 0.5    0.0   </span></a>
<a class="sourceLine" id="cb14-21" data-line-number="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-22" data-line-number="22"><span class="co">#&gt; Sample avg. posterior predictive distribution of y:</span></a>
<a class="sourceLine" id="cb14-23" data-line-number="23"><span class="co">#&gt;          Median MAD_SD</span></a>
<a class="sourceLine" id="cb14-24" data-line-number="24"><span class="co">#&gt; mean_PPD 2.0    0.1   </span></a>
<a class="sourceLine" id="cb14-25" data-line-number="25"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb14-26" data-line-number="26"><span class="co">#&gt; ------</span></a>
<a class="sourceLine" id="cb14-27" data-line-number="27"><span class="co">#&gt; * For help interpreting the printed output see ?print.stanreg</span></a>
<a class="sourceLine" id="cb14-28" data-line-number="28"><span class="co">#&gt; * For info on the priors used see ?prior_summary.stanreg</span></a></code></pre></div>
</div>
<div id="saving-a-model" class="section level3">
<h3 class="hasAnchor">
<a href="#saving-a-model" class="anchor"></a>Saving a model</h3>
<p>For testing purposes we store a simple, small object instead of a STAN model. We use the <code>cars</code> dataset that is shipped with “base R”. Use the function <code><a href="../reference/api_add_model.html">api_add_model()</a></code> to add the “model” to the database:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1"><span class="co"># Look at the head of the cars dataset</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(cars)</a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="co">#&gt;   speed dist</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="co">#&gt; 1     4    2</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="co">#&gt; 2     4   10</span></a>
<a class="sourceLine" id="cb15-6" data-line-number="6"><span class="co">#&gt; 3     7    4</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="co">#&gt; 4     7   22</span></a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt; 5     8   16</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">#&gt; 6     9   10</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co"># Add the cars dataset to the database</span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12">model_id &lt;-<span class="st"> </span>fhpredict<span class="op">:::</span><span class="kw"><a href="../reference/api_add_model.html">api_add_model</a></span>(</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">  <span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> <span class="dv">18</span>, <span class="dt">model =</span> cars, <span class="dt">comment =</span> <span class="st">"Cars in R"</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14">)</a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt; Converting model object to text ... ok. (0.00s)</span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt; The model has been stored in the database. It has been given the id 155.</span></a></code></pre></div>
<p>The function returns the id of the model that was given by the database. We stored the id in the variable <code>model_id</code>. To check if the model arrived in the database we read it back, again using <code><a href="../reference/api_get_model.html">api_get_model()</a></code></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="co"># Read the "model" back</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2">my_cars &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_model.html">api_get_model</a></span>(<span class="dv">3</span>, <span class="dv">18</span>, model_id)</a>
<a class="sourceLine" id="cb16-3" data-line-number="3"><span class="co">#&gt; Reading model with id = 155 from the database ... ok. (0.25s)</span></a>
<a class="sourceLine" id="cb16-4" data-line-number="4"><span class="co">#&gt; Warning: This does not look like a model:</span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="co">#&gt; &gt;&gt;&gt;RDA3</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="co">#&gt; A</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="co">#&gt; 3</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="co">#&gt; 198145</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="co">#&gt; 197888</span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="co">#&gt; 5&lt;&lt;&lt;</span></a>
<a class="sourceLine" id="cb16-11" data-line-number="11"><span class="co">#&gt; Returning the original text.</span></a></code></pre></div>
<p>We convince ourselves that what we get is identical to what we stored:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="co"># Nothing should have changed!</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/identical.html">identical</a></span>(cars, my_cars)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="co">#&gt; [1] FALSE</span></a></code></pre></div>
</div>
<div id="deleting-a-model" class="section level3">
<h3 class="hasAnchor">
<a href="#deleting-a-model" class="anchor"></a>Deleting a model</h3>
<p>Use the function <code><a href="../reference/api_delete_model.html">api_delete_model()</a></code> to remove a model from the database. Let’s delete the model that we just added. Its id is given in the variable <code>model_id</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="co"># Delete the model with the id given in "model_id"</span></a>
<a class="sourceLine" id="cb18-2" data-line-number="2">fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_delete_model.html">api_delete_model</a></span>(<span class="dv">3</span>, <span class="dv">18</span>, model_id)</a>
<a class="sourceLine" id="cb18-3" data-line-number="3"><span class="co">#&gt; The model with id 155 (Cars in R) was deleted.</span></a></code></pre></div>
</div>
</div>
<div id="purification-plants" class="section level2">
<h2 class="hasAnchor">
<a href="#purification-plants" class="anchor"></a>Purification Plants</h2>
<p>Use the following script to check if there are any purification plants defined. As there are many bathing spots, the script takes quite a long time and is not run here so that you do not see any outputs.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="co"># Get meta information on all bathing spots</span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2">bathing_spots &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_bathingspot.html">api_get_bathingspot</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">limit =</span> <span class="dv">10000</span>)</a>
<a class="sourceLine" id="cb19-3" data-line-number="3"></a>
<a class="sourceLine" id="cb19-4" data-line-number="4"><span class="co"># Number of bathing spots</span></a>
<a class="sourceLine" id="cb19-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span>(bathing_spots)</a>
<a class="sourceLine" id="cb19-6" data-line-number="6"></a>
<a class="sourceLine" id="cb19-7" data-line-number="7"><span class="co"># Access the "purificationPlants" endpoint for each bathing spot</span></a>
<a class="sourceLine" id="cb19-8" data-line-number="8">purification_plants &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(bathing_spots<span class="op">$</span>id, <span class="cf">function</span>(spot_id) {</a>
<a class="sourceLine" id="cb19-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb19-10" data-line-number="10">  <span class="kw"><a href="https://rdrr.io/r/base/message.html">message</a></span>(<span class="st">"spot id = "</span>, spot_id)</a>
<a class="sourceLine" id="cb19-11" data-line-number="11">  </a>
<a class="sourceLine" id="cb19-12" data-line-number="12">  result &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/postgres_get.html">postgres_get</a></span>(<span class="dt">path =</span> <span class="kw"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(</a>
<a class="sourceLine" id="cb19-13" data-line-number="13">    <span class="st">"%s/purificationPlants"</span>, </a>
<a class="sourceLine" id="cb19-14" data-line-number="14">    fhpredict<span class="op">:::</span><span class="kw"><a href="../reference/path_bathingspot.html">path_bathingspot</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> spot_id)</a>
<a class="sourceLine" id="cb19-15" data-line-number="15">  ))</a>
<a class="sourceLine" id="cb19-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb19-17" data-line-number="17">  fhpredict<span class="op">:::</span><span class="kw">stop_on_request_failure</span>(result)</a>
<a class="sourceLine" id="cb19-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb19-19" data-line-number="19">  result<span class="op">$</span>data</a>
<a class="sourceLine" id="cb19-20" data-line-number="20">})</a>
<a class="sourceLine" id="cb19-21" data-line-number="21"></a>
<a class="sourceLine" id="cb19-22" data-line-number="22"><span class="co"># How many bathing spots have purification plants?</span></a>
<a class="sourceLine" id="cb19-23" data-line-number="23"><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lengths.html">lengths</a></span>(purification_plants) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</a></code></pre></div>
</div>
<div id="rains" class="section level2">
<h2 class="hasAnchor">
<a href="#rains" class="anchor"></a>Rains</h2>
<p>This chapter describes how to</p>
<ul>
<li>read binary rain data related to a given time interval from files on the Amazon File Server,</li>
<li>spatially select and aggregate rain data that are related to a given bathing spot,</li>
<li>store the rain data in the Postgres database.</li>
</ul>
<p>Define bathing spot and reference time:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">user_id &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2">spot_id &lt;-<span class="st"> </span><span class="dv">1441</span> <span class="co"># Kleine Badewiese</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3">sampling_time &lt;-<span class="st"> "1050"</span></a></code></pre></div>
<p>There is a top-level function that can be used to perform all steps at once. For the single steps that are performed within this function, see below.</p>
<p>In the following we reduce the range of days for which to load rain data to three days. Setting <code>date_range</code> to <code>NULL</code> will instead load rain data for the whole range of dates for which measurements are available.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="co"># Function to be triggered by the user: Provide rain data for the bathing spot</span></a>
<a class="sourceLine" id="cb21-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(rain_ids &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/provide_rain_data_for_bathing_spot.html">provide_rain_data_for_bathing_spot</a></span>(</a>
<a class="sourceLine" id="cb21-3" data-line-number="3">  <span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> <span class="dv">1441</span>, <span class="dt">sampling_time =</span> <span class="st">"1050"</span>,</a>
<a class="sourceLine" id="cb21-4" data-line-number="4">  <span class="dt">date_range =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2008-07-01"</span>, <span class="st">"2008-07-03"</span>)),</a>
<a class="sourceLine" id="cb21-5" data-line-number="5">  <span class="dt">comment =</span> <span class="st">"testdata-tutorial"</span></a>
<a class="sourceLine" id="cb21-6" data-line-number="6">))</a>
<a class="sourceLine" id="cb21-7" data-line-number="7"><span class="co">#&gt; Reading https://flusshygiene-radolan-sf-data.s3.eu-central-1.amazonaws.com/08/07/01/raa01-sf_10000-0807011050-dwd---bin</span></a>
<a class="sourceLine" id="cb21-8" data-line-number="8"><span class="co">#&gt; Reading https://flusshygiene-radolan-sf-data.s3.eu-central-1.amazonaws.com/08/07/02/raa01-sf_10000-0807021050-dwd---bin</span></a>
<a class="sourceLine" id="cb21-9" data-line-number="9"><span class="co">#&gt; Reading https://flusshygiene-radolan-sf-data.s3.eu-central-1.amazonaws.com/08/07/03/raa01-sf_10000-0807031050-dwd---bin</span></a>
<a class="sourceLine" id="cb21-10" data-line-number="10"><span class="co">#&gt; A rain data record with id = 1425 has been inserted.</span></a>
<a class="sourceLine" id="cb21-11" data-line-number="11"><span class="co">#&gt; A rain data record with id = 1426 has been inserted.</span></a>
<a class="sourceLine" id="cb21-12" data-line-number="12"><span class="co">#&gt; A rain data record with id = 1427 has been inserted.</span></a>
<a class="sourceLine" id="cb21-13" data-line-number="13"><span class="co">#&gt;    user  system elapsed </span></a>
<a class="sourceLine" id="cb21-14" data-line-number="14"><span class="co">#&gt;   1.520   0.044   9.088</span></a></code></pre></div>
<p>Check that the data arrived by reloading them from the database:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># Reload rain data from the database</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2">rain &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_rain.html">api_get_rain</a></span>(<span class="dt">user_id =</span> <span class="dv">3</span>, <span class="dt">spot_id =</span> <span class="dv">1441</span>)</a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="co">#&gt; Reading rain data from database ... ok. (0.44s) </span></a>
<a class="sourceLine" id="cb22-4" data-line-number="4"><span class="co">#&gt; Converting time columns from text to POSIXct ... ok. (0.00s)</span></a>
<a class="sourceLine" id="cb22-5" data-line-number="5"></a>
<a class="sourceLine" id="cb22-6" data-line-number="6"><span class="co"># Show the first records of the rain data</span></a>
<a class="sourceLine" id="cb22-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(rain)</a>
<a class="sourceLine" id="cb22-8" data-line-number="8"><span class="co">#&gt;    id           createdAt           updatedAt            dateTime value</span></a>
<a class="sourceLine" id="cb22-9" data-line-number="9"><span class="co">#&gt; 1 801 2019-09-03 12:07:46 2019-09-03 12:07:46 2008-07-01 10:50:00 0.007</span></a>
<a class="sourceLine" id="cb22-10" data-line-number="10"><span class="co">#&gt; 2 802 2019-09-03 12:07:46 2019-09-03 12:07:46 2008-07-02 10:50:00 0.073</span></a>
<a class="sourceLine" id="cb22-11" data-line-number="11"><span class="co">#&gt; 3 803 2019-09-03 12:07:46 2019-09-03 12:07:46 2008-07-03 10:50:00 0.137</span></a>
<a class="sourceLine" id="cb22-12" data-line-number="12"><span class="co">#&gt; 4 833 2019-09-03 13:01:01 2019-09-03 13:01:01 2008-07-03 10:50:00 0.137</span></a>
<a class="sourceLine" id="cb22-13" data-line-number="13"><span class="co">#&gt; 5 909 2019-09-03 13:51:21 2019-09-03 13:51:21 2008-07-01 10:50:00 0.007</span></a>
<a class="sourceLine" id="cb22-14" data-line-number="14"><span class="co">#&gt; 6 910 2019-09-03 13:51:22 2019-09-03 13:51:22 2008-07-02 10:50:00 0.073</span></a></code></pre></div>
</div>
<div id="rains-details" class="section level2">
<h2 class="hasAnchor">
<a href="#rains-details" class="anchor"></a>Rains: Details</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">date_from &lt;-<span class="st"> "20080701"</span></a>
<a class="sourceLine" id="cb23-2" data-line-number="2">date_to &lt;-<span class="st"> "20080703"</span></a></code></pre></div>
<div id="read-rain-data-from-binary-radolan-files" class="section level3">
<h3 class="hasAnchor">
<a href="#read-rain-data-from-binary-radolan-files" class="anchor"></a>Read rain data from binary Radolan files</h3>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="co"># Read rain data for a certain time period</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2">radolan_stack &lt;-<span class="st"> </span>fhpredict<span class="op">:::</span><span class="kw">read_radolan_raster_stack</span>(</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="dt">date_from =</span> date_from,</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">  <span class="dt">date_to =</span> date_to,</a>
<a class="sourceLine" id="cb24-5" data-line-number="5">  <span class="dt">bathing_season_only =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb24-6" data-line-number="6">  <span class="dt">sampling_time =</span> sampling_time</a>
<a class="sourceLine" id="cb24-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="co">#&gt; Reading https://flusshygiene-radolan-sf-data.s3.eu-central-1.amazonaws.com/08/07/01/raa01-sf_10000-0807011050-dwd---bin</span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="co">#&gt; Reading https://flusshygiene-radolan-sf-data.s3.eu-central-1.amazonaws.com/08/07/02/raa01-sf_10000-0807021050-dwd---bin</span></a>
<a class="sourceLine" id="cb24-10" data-line-number="10"><span class="co">#&gt; Reading https://flusshygiene-radolan-sf-data.s3.eu-central-1.amazonaws.com/08/07/03/raa01-sf_10000-0807031050-dwd---bin</span></a>
<a class="sourceLine" id="cb24-11" data-line-number="11"></a>
<a class="sourceLine" id="cb24-12" data-line-number="12"><span class="co"># Show the raster images</span></a>
<a class="sourceLine" id="cb24-13" data-line-number="13">raster<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(radolan_stack)</a></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-25-1.png" width="672"></p>
</div>
<div id="spacially-select-and-aggregate-rain-data" class="section level3">
<h3 class="hasAnchor">
<a href="#spacially-select-and-aggregate-rain-data" class="anchor"></a>Spacially select and aggregate rain data</h3>
<p>We want to use only the rain data that lie within a polygon around the bathing spot. This area is a piece of metadata that are stored in the Postgres database for each bathing spot. We first read all metadata about the bathing spot defined above and provide the area information.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="co"># Get metadata about the current bathing spot</span></a>
<a class="sourceLine" id="cb25-2" data-line-number="2">spot &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_bathingspot.html">api_get_bathingspot</a></span>(<span class="dt">spot_id =</span> spot_id)</a>
<a class="sourceLine" id="cb25-3" data-line-number="3"></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="co"># Check the name of the bathing spot</span></a>
<a class="sourceLine" id="cb25-5" data-line-number="5">spot<span class="op">$</span>nameLong</a>
<a class="sourceLine" id="cb25-6" data-line-number="6"><span class="co">#&gt; [1] "UNTERHAVEL, KLEINE BADEWIESE"</span></a>
<a class="sourceLine" id="cb25-7" data-line-number="7"></a>
<a class="sourceLine" id="cb25-8" data-line-number="8"><span class="co"># Provide the polygon in the same structure as returned by</span></a>
<a class="sourceLine" id="cb25-9" data-line-number="9"><span class="co"># select_relevant_rain_area(), a function used by Wolfgang to define a polygon</span></a>
<a class="sourceLine" id="cb25-10" data-line-number="10"><span class="co"># using an R Shiny app</span></a>
<a class="sourceLine" id="cb25-11" data-line-number="11">area &lt;-<span class="st"> </span>fhpredict<span class="op">:::</span><span class="kw">convert_area_structure</span>(<span class="dt">spot_area =</span> spot<span class="op">$</span>area)</a>
<a class="sourceLine" id="cb25-12" data-line-number="12"></a>
<a class="sourceLine" id="cb25-13" data-line-number="13"><span class="co"># Show the structure of the area information (a recursive list)</span></a>
<a class="sourceLine" id="cb25-14" data-line-number="14"><span class="kw"><a href="https://rdrr.io/r/utils/str.html">str</a></span>(area, <span class="dv">2</span>)</a>
<a class="sourceLine" id="cb25-15" data-line-number="15"><span class="co">#&gt; List of 1</span></a>
<a class="sourceLine" id="cb25-16" data-line-number="16"><span class="co">#&gt;  $ geometry:List of 2</span></a>
<a class="sourceLine" id="cb25-17" data-line-number="17"><span class="co">#&gt;   ..$ type       : chr "Polygon"</span></a>
<a class="sourceLine" id="cb25-18" data-line-number="18"><span class="co">#&gt;   ..$ coordinates:List of 1</span></a></code></pre></div>
<p>In the next step we use the area information to cut the area regions from the rain data that so far comprises whole Germany:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1"><span class="co"># Crop the polygons from each raster layer</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2">cropped &lt;-<span class="st"> </span>fhpredict<span class="op">:::</span><span class="kw">crop_area_from_radolan_stack</span>(area, radolan_stack)</a></code></pre></div>
<p>We check the result by plotting the areas. <strong>Important note</strong>: It seems that not the polygon is cut but the “extent”, i.e. the smallest possible rectangle that contains the polygon!</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1">raster<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raster/man/plot.html">plot</a></span>(cropped)</a></code></pre></div>
<p><img src="tutorial_files/figure-html/unnamed-chunk-28-1.png" width="672"></p>
<p>We now calculate the average rain in each raster layer and provide a simple data frame:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1"><span class="co"># Get the mean over all layers for each point on the raster</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2">aggregated &lt;-<span class="st"> </span>raster<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/raster/man/cellStats.html">cellStats</a></span>(cropped, <span class="dt">stat =</span> mean)</a>
<a class="sourceLine" id="cb28-3" data-line-number="3"></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="co"># The day information can be restored from the names of the layers</span></a>
<a class="sourceLine" id="cb28-5" data-line-number="5">dates &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/substr.html">substr</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(radolan_stack), <span class="dv">2</span>, <span class="dv">9</span>), <span class="dt">format =</span> <span class="st">"%Y%m%d"</span>)</a>
<a class="sourceLine" id="cb28-6" data-line-number="6"></a>
<a class="sourceLine" id="cb28-7" data-line-number="7">rain &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(</a>
<a class="sourceLine" id="cb28-8" data-line-number="8">  <span class="dt">datum =</span> dates,</a>
<a class="sourceLine" id="cb28-9" data-line-number="9">  <span class="dt">rain =</span> <span class="kw"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(aggregated) <span class="op">/</span><span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb28-10" data-line-number="10">)</a></code></pre></div>
<p>Let’s have a look at the created data frame:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb29-1" data-line-number="1">rain</a>
<a class="sourceLine" id="cb29-2" data-line-number="2"><span class="co">#&gt;        datum  rain</span></a>
<a class="sourceLine" id="cb29-3" data-line-number="3"><span class="co">#&gt; 1 2008-07-01 0.007</span></a>
<a class="sourceLine" id="cb29-4" data-line-number="4"><span class="co">#&gt; 2 2008-07-02 0.073</span></a>
<a class="sourceLine" id="cb29-5" data-line-number="5"><span class="co">#&gt; 3 2008-07-03 0.137</span></a></code></pre></div>
</div>
<div id="store-the-rain-data-in-the-postgres-database" class="section level3">
<h3 class="hasAnchor">
<a href="#store-the-rain-data-in-the-postgres-database" class="anchor"></a>Store the rain data in the Postgres database</h3>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1"><span class="co"># Add rain data frame to the database</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2">rain_ids &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_add_rain.html">api_add_rain</a></span>(user_id, spot_id, rain)</a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="co">#&gt; A rain data record with id = 1431 has been inserted.</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="co">#&gt; A rain data record with id = 1432 has been inserted.</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="co">#&gt; A rain data record with id = 1433 has been inserted.</span></a>
<a class="sourceLine" id="cb30-6" data-line-number="6"></a>
<a class="sourceLine" id="cb30-7" data-line-number="7"><span class="co"># Read rain from database</span></a>
<a class="sourceLine" id="cb30-8" data-line-number="8">rain &lt;-<span class="st"> </span>fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_get_rain.html">api_get_rain</a></span>(user_id, spot_id)</a>
<a class="sourceLine" id="cb30-9" data-line-number="9"><span class="co">#&gt; Reading rain data from database ... ok. (0.44s) </span></a>
<a class="sourceLine" id="cb30-10" data-line-number="10"><span class="co">#&gt; Converting time columns from text to POSIXct ... ok. (0.00s)</span></a>
<a class="sourceLine" id="cb30-11" data-line-number="11"></a>
<a class="sourceLine" id="cb30-12" data-line-number="12"><span class="co"># What should we do with duplicates?</span></a>
<a class="sourceLine" id="cb30-13" data-line-number="13"><span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/duplicated.html">duplicated</a></span>(kwb.utils<span class="op">::</span><span class="kw">selectColumns</span>(rain, <span class="st">"dateTime"</span>)))</a>
<a class="sourceLine" id="cb30-14" data-line-number="14"><span class="co">#&gt; [1] 320</span></a>
<a class="sourceLine" id="cb30-15" data-line-number="15"></a>
<a class="sourceLine" id="cb30-16" data-line-number="16"><span class="co"># Delete rain data with given rain record ids</span></a>
<a class="sourceLine" id="cb30-17" data-line-number="17">fhpredict<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/fhpredict/man/api_delete_rain.html">api_delete_rain</a></span>(user_id, spot_id, rain_ids)</a>
<a class="sourceLine" id="cb30-18" data-line-number="18"><span class="co">#&gt; Deleting rain data point with id 1431 ... ok. (0.25s) </span></a>
<a class="sourceLine" id="cb30-19" data-line-number="19"><span class="co">#&gt; Deleting rain data point with id 1432 ... ok. (0.25s) </span></a>
<a class="sourceLine" id="cb30-20" data-line-number="20"><span class="co">#&gt; Deleting rain data point with id 1433 ... ok. (0.25s)</span></a>
<a class="sourceLine" id="cb30-21" data-line-number="21"></a>
<a class="sourceLine" id="cb30-22" data-line-number="22"><span class="co"># For simplicity reasons: delete all rain data before inserting new data</span></a>
<a class="sourceLine" id="cb30-23" data-line-number="23"><span class="co">#fhpredict::api_delete_rain(user_id, spot_id)</span></a>
<a class="sourceLine" id="cb30-24" data-line-number="24"></a>
<a class="sourceLine" id="cb30-25" data-line-number="25"><span class="co"># </span><span class="al">TODO</span><span class="co">: Remove only the duplicates, keeping the most current values</span></a></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#install-the-package">Install the package</a></li>
      <li><a href="#users">Users</a></li>
      <li><a href="#bathing-spots">Bathing Spots</a></li>
      <li><a href="#models">Models</a></li>
      <li><a href="#purification-plants">Purification Plants</a></li>
      <li><a href="#rains">Rains</a></li>
      <li><a href="#rains-details">Rains: Details</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.researchgate.net/profile/Wolfgang_Seis">Wolfgang Seis</a>, <a href="https://github.com/hsonne">Hauke Sonnenberg</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.0.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: 'eab9471a295adad1867e1368f918ef6d',
    indexName: 'kwb_fhpredict',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
